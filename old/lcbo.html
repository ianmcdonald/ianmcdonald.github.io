<!DOCTYPE html>
<meta name="viewport" content="width=device-width, initial-scale=1 user-scalable=no">
<meta name="description" content="Designer and developer from St. Catharines, Canada.">
<title>Ian Mcdonald</title>
<!-- <link href="assets/css/main.css" rel="stylesheet"> -->

<style>
 .axis path,
 .axis line {
     fill: none;
     stroke: tomato;
     stroke-width: 1px;
     shape-rendering: crispEdges;
 }
</style>


<body>
    <main>

    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js"></script>

    <script>

     var key = 'MDpmNjkyMjc2ZS1mZTU1LTExZTUtOGMyMS01MzUwZDE4MGRiYzY6cmExZ0M4aFFOS2Jacm0xRWlqNFltcEdpbUlJaWdaVXE0V3o2';
     var xhr = new XMLHttpRequest();
     var dataset;

     function booze(params) {

         xhr.onreadystatechange = function() {
             if (xhr.readyState === 4 && xhr.status === 200) {

                 dataset = JSON.parse(xhr.responseText);


                 // Create some globals
                 const w   = window.innerWidth - 50,
                       h   = window.innerHeight - 50,
                       r   = 7,
                       svg = d3.select('main')
                               .append('svg')
                               .attr({
                                   width:  w,
                                   height: h
                               })


                 // Define the scale
                 const xScale = d3.scale.linear()
                                  .domain([1, d3.max(dataset.result, d => d.price_per_liter_of_alcohol_in_cents) + 100000])
                                  .range([5, w]);

                 const yScale = d3.scale.linear()
                                  .domain([1, d3.max(dataset.result, d => d.alcohol_content) + 1000])
                                  .range([h, 0]);


                 // Render plot points
                 svg.selectAll('g')
                    .data(dataset.result)
                    .enter()
                    .append('g')
                    .append('circle')
                    .attr({
                        'cx': d => xScale(d.price_per_liter_of_alcohol_in_cents),
                        'cy': d => yScale(d.alcohol_content),
                        'r' : r
                    })
                    .style({
                        'fill': 'tomato',
                        'opacity': '0.5'
                    })
                    .on('mouseover', showLabel)
                    .on('mouseout', hideLabel)

                 // Render text labels
                 svg.selectAll('g')
                    .data(dataset.result)
                    .append('text')
                    .html(d => d.name)
                    .attr({
                        'x': d => xScale(d.price_per_liter_of_alcohol_in_cents) + 10,
                        'y': d => yScale(d.alcohol_content) + (r * 5),
                        'font-size': '0.75em',
                        'text-anchor': 'middle'
                    })
                    .style({
                        'display': 'none'
                    })


                 // Define x-axis
                 const xAxis = d3.svg.axis()
                                 .scale(xScale)
                                 .orient('bottom')

                 // Render x-axis
                 svg.append('g')
                                 .attr('class', 'axis')
                                 .attr('transform', `translate(5, ${h - 20})`)
                                 .style('font-size', '10px')
                                 .call(xAxis);

                 // Define y-axis
                 const yAxis = d3.svg.axis()
                                 .scale(yScale)
                                 .orient('left')
                 //   .ticks(8);

                 // Render y-axis
                 svg.append('g')
                                 .attr('class', 'axis')
                                 .attr('transform', 'translate(50, -5)')
                                 .style('font-size', '10px')
                                 .call(yAxis);


             }
         };

         xhr.open('GET', 'https://lcboapi.com/products?access_key=' + key + '&' + params, true);
         xhr.send();
     }

     booze('order=price_per_liter_of_alcohol_in_cents');


     function showLabel() {
         this.style.fill = 'blue';
         this.nextElementSibling.style.display = 'block';
     }

     function hideLabel() {
         this.style.fill = 'tomato';
         this.nextElementSibling.style.display = 'none';
     }





    </script>
